{
  "id": "androidphone-feature",
  "title": "Android Phone Automation Feature for Frank Bot",
  "description": "Implement LLM-driven mobile app control via ADB over WiFi, starting with thermostat MVP",
  "authors": [
    { "name": "Sean Reardon", "type": "human" },
    { "name": "Claude", "type": "model" }
  ],
  "createdAt": "2026-02-05T00:00:00Z",
  "status": "ready",
  "tags": ["frank_bot", "android", "automation", "adb", "llm-loop", "mvp"],
  "content": "# Android Phone Automation Feature\n\n## Context\n\nFrank Bot is a personal automation server that exposes various services (Google Calendar, Contacts, SMS, etc.) as OpenAI Actions. We've added a dedicated Android phone (Pixel 9 Pro Fold, rooted with Magisk) connected via ADB over WiFi at 10.0.0.95:5555.\n\nThis phone can now be controlled programmatically, enabling Frank to interact with mobile apps that don't have APIs - like Uber, Uber Eats, OpenTable, and smart home apps.\n\n## Goal\n\nImplement the `androidPhone*` family of actions that use an LLM-in-the-loop pattern to control mobile apps. The LLM interprets the screen state (accessibility XML + screenshots) and decides what actions to take (tap, type, swipe) until the task is complete.\n\n## MVP: Thermostat Control\n\nStart with thermostat control via Google Home app as the MVP:\n- `androidPhone_thermostat_setRange(low_temp, high_temp)` - Set temperature range\n- `androidPhone_thermostat_getStatus()` - Get current temperature and settings\n\nThis is simpler than ride-hailing because:\n1. UI is more predictable\n2. No time-sensitive interactions\n3. No payment/purchase approval needed\n4. Easy to verify success\n\n## Architecture\n\n### Core Components\n\n1. **`services/android_phone_runner.py`** - LLM loop orchestrator\n   - Loads prompt templates from `prompts/androidPhone/`\n   - Captures screen state (XML + screenshot) at each step\n   - Sends state to LLM, receives action decision\n   - Executes action via `services/android_client.py`\n   - Loops until task complete or error\n   - Tracks tokens and costs\n\n2. **`actions/android_phone.py`** - Action handlers (expand existing)\n   - Each action loads appropriate prompt template\n   - Creates AndroidPhoneRunner and executes task\n   - Returns structured result\n\n3. **`prompts/androidPhone/`** - Prompt templates\n   - `_base.md` - Common instructions for phone control\n   - `thermostat-setRange.md` - Thermostat set range workflow\n   - `thermostat-getStatus.md` - Thermostat status check\n\n### Key Diagnostic Action\n\n`androidPhoneGetScreen` - Returns both:\n- Screenshot as base64-encoded PNG\n- Raw accessibility XML\n- Parsed clickable elements with coordinates\n\nThis is critical for:\n- Debugging failed automations\n- Manual intervention when needed\n- Visual confirmation in ChatGPT\n\n## Prompt Template Structure\n\nEach template follows this structure:\n\n```markdown\n# androidPhone: [Action Name]\n\n## Goal\n[What this action accomplishes]\n\n## Parameters\n[Input parameters with types and defaults]\n\n## App Information\n- Package: [com.example.app]\n- Entry point: [How to get to the right screen]\n- Expected state: [What state the app should be in]\n\n## Workflow Steps\n[Numbered steps the LLM should follow]\n\n## Success Criteria\n[How to know the task is complete]\n\n## Error Handling\n[Common errors and how to handle them]\n\n## Known UI Patterns\n[Specific UI elements to look for]\n```\n\n## Maintenance Features\n\n### Monthly Maintenance Jorb\nScheduled jorb (1st of month, 3 AM):\n- Check device health\n- Install app updates\n- Check Android security patches\n- Clear caches if storage low\n- Report issues to Sean via Telegram\n\n### Weekly Health Check\nScheduled jorb (Sunday, 4 AM):\n- Verify connection\n- Check battery/WiFi\n- Test app launch\n- Report only if issues\n\n## API Endpoints\n\n### Diagnostics\n- `GET /actions/androidPhone/status` - Connection status\n- `GET /actions/androidPhone/apps` - List apps\n- `GET /actions/androidPhone/getScreen` - Screenshot + XML\n- `GET /actions/androidPhone/health` - Full health check\n\n### Thermostat (MVP)\n- `GET /actions/androidPhone/thermostat/setRange?low_temp=68&high_temp=72`\n- `GET /actions/androidPhone/thermostat/getStatus`\n\n### Maintenance\n- `GET /actions/androidPhone/maintenance/updateApps`\n- `GET /actions/androidPhone/maintenance/checkSecurity`\n- `GET /actions/androidPhone/maintenance/reboot`\n\n## Implementation Order\n\n### Phase 1: Core Infrastructure\n1. Create `androidPhoneGetScreen` action - screenshot + XML diagnostic\n2. Create `AndroidPhoneRunner` service with basic LLM loop\n3. Create `_base.md` prompt template\n\n### Phase 2: Thermostat MVP\n4. Create `thermostat-setRange.md` prompt template\n5. Create `thermostat-getStatus.md` prompt template\n6. Implement `androidPhone_thermostat_setRange` action\n7. Implement `androidPhone_thermostat_getStatus` action\n8. Test end-to-end with real thermostat\n\n### Phase 3: Maintenance\n9. Create `AndroidMaintenanceService`\n10. Add monthly/weekly scheduled jorbs\n11. Create maintenance prompt templates\n\n## Files to Create/Modify\n\n### New Files\n- `services/android_phone_runner.py`\n- `services/android_maintenance.py`\n- `prompts/androidPhone/_base.md`\n- `prompts/androidPhone/thermostat-setRange.md`\n- `prompts/androidPhone/thermostat-getStatus.md`\n- `prompts/androidPhone/maintenance-updateApps.md`\n\n### Modify\n- `actions/android.py` â†’ rename/expand to `actions/android_phone.py`\n- `server/routes.py` - Add new endpoints\n- `openapi/spec.json` - Document new endpoints\n- `services/background_loop.py` - Add maintenance schedules\n\n## Security Requirements\n\n- All endpoints require API key\n- Phone only accessible on local network\n- Audit logging for all actions\n- Approval required for purchases over threshold\n- Rate limiting (10/min, 100/hour)\n\n## Testing\n\n1. Unit tests with mocked ADB\n2. Integration test: connect, get screen, verify\n3. E2E test: set thermostat, verify, get status\n\n## Design Document\n\nFull design document at: `prompts/androidPhone-design.md`\n\n## Existing Code\n\n- `services/android_client.py` - ADB wrapper (already implemented)\n- `actions/android.py` - Basic actions (already implemented)\n- Device verified working at 10.0.0.95:5555\n",
  "executions": []
}
